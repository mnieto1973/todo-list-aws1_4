pipeline {
    agent { label 'default' }

    stages {
        stage('Load Branch Specific Jenkinsfile') {
            steps {
                script {
                    // Obtener el nombre de la rama actual
                    def branchName = env.BRANCH_NAME

                    // Definir el nombre del Jenkinsfile específico basado en la rama
                    def jenkinsFilePath = ""
                    if (branchName == "develop") {
                        jenkinsFilePath = "Jenkinsfile_staging"
                    } else if (branchName == "master") {
                         jenkinsFilePath = "JenkinsfileCd"
                    } else {
                        error "No Jenkinsfile defined for branch ${branchName}"
                    }

                    // Ejecutar dentro de un nodo para asegurar acceso al workspace
                    node {
                        // Actualizar el repositorio para asegurarse de tener la última versión del código
                        checkout scm

                        // Verificar si el Jenkinsfile específico existe en el sistema de archivos
                        if (!fileExists(jenkinsFilePath)) {
                            error "The specified Jenkinsfile (${jenkinsFilePath}) does not exist in branch ${branchName}"
                        }

                        // Cargar y ejecutar el Jenkinsfile específico de la rama
                        load jenkinsFilePath
                    }
                }
            }
        }
    }
}


