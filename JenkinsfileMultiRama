pipeline {
    agent { label 'default' }

    stages {
        stage('Determine Branch Specific Jenkinsfile') {
            steps {
                script {
                    // Obtener el nombre de la rama actual
                    def branchName = env.BRANCH_NAME

                    // Definir el nombre del Jenkinsfile específico basado en la rama
                    def jenkinsFilePath = ""
                    if (branchName == "develop") {
                        jenkinsFilePath = "JenkinsfileCd"
                    } else if (branchName == "master") {
                        jenkinsFilePath = "JenkinsfileProductionSeparado"
                    } else {
                        error "No Jenkinsfile defined for branch ${branchName}"
                    }

                    // Imprimir el contenido del workspace para depuración
                    echo "Workspace content:"
                    sh 'ls -l'

                    // Verificar si el Jenkinsfile específico existe en el sistema de archivos
                    if (!fileExists(jenkinsFilePath)) {
                        error "The specified Jenkinsfile (${jenkinsFilePath}) does not exist in branch ${branchName}"
                    }

                    // Cargar y ejecutar el Jenkinsfile específico de la rama
                    def branchSpecificScript = load jenkinsFilePath
                    echo "Loaded ${jenkinsFilePath}"
                    branchSpecificScript.runPipeline()
                }
            }
        }
    }
}
